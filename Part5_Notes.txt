------
Part 5
------
a. Login in frontend 
    - intro 
        - will implement front end that supports user management functionality 
        - Logging in is done by sending an HTTP POST request to server address api/login
            - login success: form fields are emptied and the server response is saved to the user field to the applications state 
            - login fail: results in an error, the user is notified 
            - show the login form only if the user is not logged in 
            - react trick for conditional rendering: 
                -  
                    {user === null ?
                    loginForm() :
                    noteForm()
                    }

    - creating new notes 
        - token returned with successful login is saved to the application state user field token 
        - we have to fix creating new notes to work with the backend
            - noteService module would contain a private variable token. It's value can be changed with a function setToken, which is exported by the module 
            - create, now with async/await syntax, sets the token to the Authorization header 

    - saving the token to browsers local storage 
        - when pages are rerendered, information of the user's login disappears
        - use local storage (cache) to save key-value database in the browser 
        - values in the storage stay even when the page is rerendered. 
        - storage is origin-specific so each web app has its own storage 
        - values saved to the storage are DOMstrings, so we cannot save a JavaScript object as is. The object has to be first parsed to JSON with JSON.stringify and then parsed back with JSON.parse
        - use effecthook to fetch notes from the server to the frontend 
        - empty array as the parameter of the effect ensures that he effect is executed oly when the component is rendered for the first time 
        - logging out:
            - window.localStorage.removeItem('loggedNoteappUser')
            - window.loclStorage.clear()

b. props.children and proptypes 
    - displaying login info form only when appropriate 
        - use <div style={hideWhenVisible}> to toggle if we should hide / show sections in the component 
        
    - props.children 
        - Toggable component has both opening and closing tags which surround a LoginFom component. In React terminology LoginForm is a child component of Toggable 
            - we can add any React elements we want between the opening and closing tags of Toggable 
        - the props.children is the code used for referencing the child components of the component. THe child components are the React elements we define between the opening and closing tag of a component 
            - children is automatically added by React and always exists. If a component is defined with an automatically closing />, then the props.children is an empty array 
    
    - state of the forms 
        - should life the shared state up to their closest common ancestor 
        - move the state of hte forms to their corresponding components 
        - functionality should also be passed as well 

    - references to components with ref 
        - use the ref keyword which offers a reference to the component
        - Visibility is controlled with the visible variable inside the Toggable component, but we would want to access it outside of the component 
        - Function that creates the component is wrapped inside ofa forwardRef function call, allowing the component to access the ref that is assigned to it 
        - component uses the useImperativeHandle hook to make its toggleVisibility function available outside of the component
        - we can now hide the form by calling notFormRef.current.toggleVisibility() after a new note has been created 

    - one point about components 
        - when we define a component and create three components, each one has its own separate state 

    - PropTypes 
        - we can defined a prop as mandatory or required string-type prop, so that it won't render empty string 

c. Testing react apps 
    - use jest and react-testing-library to help with testing react apps 
    - will write the rendering the component for tests in the same directory as the tests themselves 

    - rendering the component for tests 
        - the test renders the component with the render method provided by the react-testing-library
            - normal react components are rendered to the DOM., but the render method renders the components in a format that is suitable for tests without rendering them to the DOM 
            - render return object with several properties:
                - container: contains all of the HTML rendered by the component 
                -

    - running tests:
        - create-react-app configures tests otb e run in watch mode by default, which means that the npm test command will not exit once the tests have finished, and will instead wait for changes to be made to the code 
        - if we want to run tests "normally" then we would use the CI=true npm test command 
    
    - test file location 
        - two different conventions for the test file's location:
            - in the same directory as the component 
            - in its own separate "test" directory 
    
    - searching for content in a component 
        1) uses method toHaveContent to search for a matching text from the entire HTML code rendered by the component 
        2) uses the getByText method of the object returned by he render method. Method returns the element that contains the given text 
        3) search for specific element that is rendered by the component with the query selector method that receives a CSS selector as its parameter 
            - last two methods use the methods getByText and querySElector to find an element matching some condition from the rendered component 
    
    - Debugging tests 
        - object returned by the render method has a debug method that can be used to print the HTML rendered by the component to the console 
        - we can also search for a smaller part of the component and print its HTML code 
            - use the prettyDOM method that can be imported from the @testing-library/dom package that is automatically installed with react testing library
            - we used the selector to find the li element inside of the component and printed its HTML to the console 
            - console.log(prettyDOM(li))

    - click buttons in tests 
        - Note component also makes sure that when the button associated with the note is pressed, the toggleImportance event handler function gets called 
        - event handler can be defined as a mock function 
        - test finds the button based on the text from the rendered component and clicks the element 
            - clicking happens with the fireEvent method 
        - Mock objects and functions are commonly used stub components in testing that are used for replacing dependencies of the components being tested
            - mocks make it possible to return hard-coded responses, and to verify the number of times the mock functions are called and with what parameters 

    - tests for the Togglable component 
        - querySelector returns the first matching button
    
    - testing the forms 
        - we can simulate text input with fireEvent

            fireEvent.change(input, { 
                target: {value: 'testing of forms could be easier'}
            })

            fireEvent.submit(form)

    - find out coverage of our tests by 
        - CI=true npm test -- --coverage

d. End to end testing